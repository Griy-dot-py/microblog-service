<h1 align="center">Python Сервис микроблогов</h1>

<h3 align="center">
    <img src="https://img.shields.io/badge/python-3.12-blue">
</h3>

Back-end сервиса микроблогов-аналога Twitter, реализованный с использованием языка python и асинхронного фреймровка FastAPI.

## О поекте
На данный момент сервис представляет собой REST API, позволяющий:
 * создавать и удалять твиты, просматривать ленту на основе интересующих авторов
 * зафолловить другого пользователя и перестать
 * лайкать твиты и убирать лайки
 * просматривать свой и чужой профили

#### База данных
За хранение данных приложения отвечает выделенный сервер **PostgeSQL**, за взаимодейсвия с ним отвечает ORM *SQLAlchemy*. База имеет следующюю структуру:
![](./public/structure.png)
*Для визуализации была использована доска  miro*

#### Асинхронные запросы
Сервис полностью асинхронный, все endpoint'ы являются корутинами. При большой нагрузке, пользователи не будут ждать, пока кто-то другой получит ответ от сервера. Так как основная задержка происходит в момент ожидания ответа от базы данных, запросы к ней также выполняются асинхронно. Весь код выполнен с использованием `async`/`await`.

#### Тестирование
Код приложения полностью покрыт unit-тестами. Для тестов к функциям и методам использован *pytest* и его расширение *pytest-asyncio* для корутин соответственно. Процент покрытия тестами вычислен утилитой *pytest-cov*.


## Установка и настройка
В этом разделе будет инструкция по установке и настройке сервиса. Предварительно вам нужно загрузить исходный код либо клонируя репозиторий, либо скачав zip-архив и распаковав его в нужной директории.

Далее необходимо установить переменные окружения:
1. Скопируйте содержимое `config/.env.example` в файл `config/.env`.
2. Если вы не планируете запуск через Docker compose или просто хотите изменить значения по умолчанию, то на этом этапе сконфигурируйте только что скопированный файл `.env`. Советую поменять хотя бы пароль на более надежный.

#### С помощью Docker Compose
Даже если вы собираетесь запускать приложение таким образом, из соображений безопасности, советую поменять пользователя/пароль на более надежные, нежели postgres/postgres.

Непосредственно сборка и запуск происходит следующей коммандой (выполняем из корня проекта):
```
docker compose -f Docker/docker-compose.yml --env-file config/.env up --build
```

#### Напрямую
Этот способ подходит, если у вас уже есть готовый PostgreSQL сервер. В таком случае в `.env` стоит занести данные от него.

Для запуска необходимо иметь установленный интерпретатор *python*, версии не ниже той что на бейдже в самом верху. Обновить его можно, скачав с офф. сайта [python](https://www.python.org/).

Также обязательным будет наличие установленного пакетно менеджера *poetry* на компьютере, где вы собираетесь запускать проект. Установить его можно, следуя инструкции из [документации](https://python-poetry.org/docs/) утилиты.

Устанавливаем зависимости следующей коммандой:
```
poetry install --sync --only=main
```
Далее запускаем проект:
```
cd src
poetry run uvicorn routes:app
```
*Для более гибкой настройки poetry советую более подробно ознакомится с его документацией*

#### Переменные окружения
|Переменная|Значение по умолчанию|Описание|
|:-:|-|-|
|POSTGRES_HOST|"database"|Хост сервера БД. Оставляем "database" в случае запуска через docker compose|
|POSTGRES_DB|"microblog"|Имя базы данных внутри postgres сервера|
|POSTGRES_USER|"postgres"|Имя пользователя БД|
|POSTGRES_PASSWORD|"postgres"|Пароль от БД|
|TEST_MODE|"false"|Булево значение, выставляем `"true"`, когда тестируем приложение(исп. конечно же тестовую БД). На проде оставляем как есть|
